



# 名词

**地址总线**:地址不只是指向内存，还指向其他储存介质。如显存。数据直接落到现存中。

**指令**：操作数和操作码组成。

**标号名**：会被汇编器翻译成某个地址。

**bss段**:具有全局属性但是没初始化的数据。

Mbr(main boot record):主引导扇区,位于0盘0道1扇区。一般一个扇区512字节。

mbr包含:

- 446字节的引导程序及参数；
- 64字节的分区表；
- 2字节的结束标记0x55和0xaa。

**寻址方式**:

- 寄存器寻址

- 立即数寻址

- 内存寻址

  - 直接寻址
  - 基址寻址[bx,bp]
  - 变址寻址[si,di]
    - 主要用于字符搬运
    - 一般都是配合基址一起用

  - 基址变址寻址

- 输入输出控制中心(i/o control hub,ich)：又称南桥，负责io接口竞争和连接各种内部总线。连接pci、pice、agp。

- 北桥:连接高速设备，如内存。

## 保护模式:

全局描述符:内存段登记表





![段描述符的分类](https://tva1.sinaimg.cn/large/007S8ZIlly1gi6l5kdx3xj30j30codht.jpg)

段描述符

#### 段描述符:p153

- G:粒度为 (1)4kb 或者  (0)字节。

- 向上扩展，段限长表示段内便宜最大值

- 实际段界限边界值:（limit+1)*粒度-1

  - -1是因为地址从0开始的
  - +1是因为段界限是从0开始的

- s位:系统段或非系统段

  - 0系统段:硬件运行需要的，例如各种门。(调用门、任务门）
  - 1非系统段:软件用的，无论代码/数据/栈都是非系统段。

  ![image-20200828171538266](https://tva1.sinaimg.cn/large/007S8ZIlly1gi6n8afdgkj30u0140x6d.jpg)

![捕获](https://tva1.sinaimg.cn/large/007S8ZIlly1gi6l6aykekj30ji0ac0uw.jpg)

![数据段描述符](https://tva1.sinaimg.cn/large/007S8ZIlly1gi6l89t198j30iq05y75k.jpg)

![代码段描述符](https://tva1.sinaimg.cn/large/007S8ZIlly1gi6l8irav2j30iv062myh.jpg)

### 一致代码段:

 　简单理解，就是操作系统拿出来被共享的代码段,可以被低特权级的用户直接调用访问的代码。通常这些共享代码，是"不访问"受保护的资源和某些类型异常处理。比如一些数学计算函数库,为纯粹的数学运算计算，被作为一致代码段。

### 一致代码段的限制作用：

1. 特权级高的程序不允许访问特权级低的数据:核心态不允许调用用户态的数据.
2. 特权级低的程序可以访问到特权级高的数据.但是特权级不会改变:用户态还是用户态.

### 非一致代码段:

　　为了避免低特权级的访问而被操作系统保护起来的系统代码.

### 非一致代码段的限制作用

1. 只允许同级间访问.
2. 绝对禁止不同级访问:核心态不用用户态.用户态也不使用核心态.



#### Gdtr：段描述符寄存器 

Nasm指令:

## Nasm指令:

**`$` 和 `$$`**：用来表示当前行和本section的地址。

**标号**：地址标记。

> nasm编译:先cd到文件目录,`nasm -o mbr.bin mbr.S`

**section**:伪指令,人为分割程序。

`section.xx.start`为xxx起始地址。

**vstart:**virtual start address，用于计算 section内所有 内存引用地址。

相当于以xxx为起始地址编译。

**数据类型伪指令**:`byte、word、dword、qword。`

**默认文本模式**：80*25,一屏2000个字符。

## linux命令:

**dd:磁盘操作命令(p63)**

`man dd`查看说明

`dd if=/要写入的文件 of=/待写入的文件 bs=512 count=1 conv=notrunc`

`xxd 逐字节查看`

`readelf`读取elf格式



##汇编

**call**:

- 16位实模式相对近调用：
  - 段内调用,相对地址=目标-当前-机器码。范围-32768～32767。‘
  - near可省略。
  - 操作数是立即数。
- 16位实模式 间接 绝对 近调用:
  - 间接:由寄存器、内存给出。
  - 绝对:绝对地址。
  - 使用ret。
- 16位实模式直接绝对远调用:`call far 段基址:段内偏移地址`
  - 先把cs寄存器入栈，再把ip寄存器入。
  - far也是可省略。
  - 使用retf。
- 16位实模式间接绝对远调用：
  - 只能用内存寻址。
  - far不能省略。

**jmp:**

1. **16位实模式相对短转移`jmp short`:**
   1. 操作数是立即数
   2. 范围是-128～127
2. **16位实模式相对近转移`jmp near`:**
   1. 操作数是立即数
   2. 范围是-32768～32767
3. 16位实模式间接绝对近转移:
   1. 操作数由内存或者寄存器给出。
   2. near可省略。
   3. 使用内存，默认段寄存器ds。
4. 16位实模式直接绝对远转移
   1. 操作数是立即数`jmp 0:start`
5. 16位实模式间接绝对远转移
   1. 只能由内存给出`jmp far [addr]`
   2. 指令只能是`jmp far`



#### in/out指令

in代表从端口读取数据

`in 目的操作数,源操作数`

```assembly
In al,ax
in ax,dx
```

固定用法，源操作数必须是dx。

out代表向端口写入数据

`out 目的操作数,源操作数`

```
out dx,al;
out dx,ax;
out 立即数,al;
out 立即数,ax;
```

用al还是ax要看端口指向的寄存器宽度是多少。

####  mul

`mul 寄存器/内存`

`imul 寄存器/内存 ;有符号数`

- 如果乘数是8位，则寄存器al当作另1个乘数，结果是16位，保存在ax中。
- 如果是16位，则把寄存器ax当作另1个乘数，结果32位，存入dx:ax，dx是高16位结果。
- 如32位，则eax，存入edx:eax，edx高32位。

#### div

- 除数8位，被除数16位，位于ax中。商在al，余数在ah。
- 除数16，则被除数32，被除数高16位在dx，低16位在ax。商在ax，余数在dx。
- 32，64，被除数高32位在edx，低32位在eax，商eax，余数edx。

#### invlpg 

立即刷新tlb缓存。操作数是虚拟地址内存地址

`invlpg [0x1234]`

#### 字符串搬运

`movsb\movsw\movsd`

将ds:si指向的内容搬送到es:di指向的地址处。

cld:方向位清0.向后搬运，sld相反。